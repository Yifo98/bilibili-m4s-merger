# 使用指南

## 快速开始

### 第一步：准备环境

确保你的电脑已安装：
- Python 3.6+
- FFmpeg（并已添加到系统PATH）

### 第二步：下载工具

下载 `合并B站视频.py` 和 `合并B站视频.bat` 两个文件。

### 第三步：运行

将这两个文件复制到包含m4s文件的文件夹中，双击 `合并B站视频.bat`。

## 详细说明

### B站下载文件说明

使用IDM或其他工具下载B站视频时，通常会得到以下文件：

```
视频名称_哔哩哔哩_bilibili.m4s        (音频文件)
视频名称_哔哩哔哩_bilibili_2.m4s      (视频文件)
视频名称_哔哩哔哩_bilibili_2_2.m4s    (可能是视频或音频)
...
```

### 合并原理

本工具通过以下步骤工作：

1. **扫描**：查找目录下所有 `.m4s` 文件
2. **识别**：使用 `ffprobe` 检测每个文件是视频还是音频
3. **配对**：根据时长和大小匹配对应的视频和音频
4. **合并**：使用 `ffmpeg` 的 `-c copy` 参数进行无损合并
5. **清理**：删除已成功合并的源文件

### 输出文件命名

合并后的MP4文件命名规则：

```
原始名称.mp4          (如果不存在同名文件)
原始名称_1.mp4        (如果已存在)
原始名称_2.mp4        (以此类推)
```

## 高级配置

### 修改删除行为

打开 `合并B站视频.py`，找到第30行：

```python
DELETE_SOURCE_AFTER_MERGE = True   # 改为 False 则保留源文件
```

### 自定义FFmpeg路径

如果FFmpeg不在PATH中，可以指定完整路径：

```python
FFMPEG_PATH = r"C:\path\to\ffmpeg\bin\ffmpeg.exe"
```

## 故障排除

### 问题：合并后视频无法播放

**原因**：视频和音频文件不匹配

**解决**：
1. 检查是否正确下载了视频和音频文件
2. 手动用播放器测试m4s文件是否能播放

### 问题：提示"找不到ffmpeg"

**原因**：FFmpeg未安装或未添加到PATH

**解决**：
1. 下载FFmpeg：https://ffmpeg.org/download.html
2. 解压后将 `bin` 目录添加到系统环境变量

### 问题：合并速度很慢

**说明**：本工具使用 `-c copy` 进行流复制，不进行重新编码，速度应该很快。如果感觉慢，可能是：
- 硬盘读写速度慢
- 文件非常大
- 第一次运行时杀毒软件扫描

## 常见问题 FAQ

**Q: 可以合并其他网站下载的视频吗？**

A: 理论上可以，只要是分离的视频+音频m4s格式。

**Q: 支持macOS/Linux吗？**

A: Python脚本可以，但bat文件不支持。直接运行 `python 合并B站视频.py` 即可。

**Q: 会降低视频质量吗？**

A: 不会。使用 `-c copy` 参数，直接复制数据流，不重新编码。

**Q: 可以批量合并多个文件夹吗？**

A: 目前版本需要分别在各个文件夹运行。未来版本可能会支持递归处理。
